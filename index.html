<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Space Today - NASA Astronomy Picture of the Day</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #0a0a14;
      --card-bg: rgba(15, 15, 25, 0.7);
      --card-border: rgba(255, 255, 255, 0.05);
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.6);
      --accent-color: #6b8afd;
      --accent-hover: #7d9cff;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --gradient: linear-gradient(135deg, #6b8afd 0%, #89a3ff 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html.lenis {
      height: auto;
    }

    .lenis.lenis-smooth {
      scroll-behavior: auto;
    }

    .lenis.lenis-smooth [data-lenis-prevent] {
      overscroll-behavior: contain;
    }

    .lenis.lenis-stopped {
      overflow: hidden;
    }

    .lenis.lenis-scrolling iframe {
      pointer-events: none;
    }

    body {
      font-family: 'Inter', sans-serif;
      font-weight: 300;
      background-color: var(--bg-color);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    #tsparticles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-color);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .planet {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 60px rgba(107, 138, 253, 0.3);
    }

    .planet::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 30%, #6b8afd 0%, #4a5fcc 60%, #2d3a8c 100%);
      border-radius: 50%;
    }

    .planet::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 70% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 40%);
      border-radius: 50%;
    }

    .rocket {
      font-size: 2.5rem;
      position: absolute;
      transform: rotate(45deg);
      filter: drop-shadow(0 0 10px rgba(107, 138, 253, 0.7));
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      opacity: 0;
      transform: translateY(20px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--card-border);
    }

    .title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .nasa-logo {
      width: 42px;
      height: 42px;
      filter: brightness(0) invert(1);
    }

    h1 {
      font-weight: 300;
      font-size: 1.8rem;
      letter-spacing: -0.5px;
    }

    .controls-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    #date-picker {
      background: transparent;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      color: var(--text-primary);
      padding: 0.6rem 1rem;
      font-family: 'Inter', sans-serif;
      font-weight: 300;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    #date-picker:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .control-btn {
      background: transparent;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      color: var(--text-primary);
      width: 42px;
      height: 42px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
    }

    .control-btn:hover {
      border-color: var(--accent-color);
      color: var(--accent-color);
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2.5rem;
      margin-bottom: 3rem;
    }

    .media-container {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      aspect-ratio: 16/9;
    }

    #apod-image, #apod-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .media-overlay {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 2;
    }

    .info-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    h2 {
      font-weight: 300;
      font-size: 1.8rem;
      line-height: 1.3;
      letter-spacing: -0.5px;
    }

    .explanation-container {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 1rem;
    }

    #apod-explanation {
      font-weight: 300;
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    #copyright {
      font-weight: 300;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--card-border);
      padding-top: 1rem;
    }

    .loader-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(10, 10, 20, 0.8);
      z-index: 10;
      border-radius: 12px;
    }

    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }

    .close-btn {
      position: absolute;
      top: 2rem;
      right: 2rem;
      font-size: 2.5rem;
      color: white;
      cursor: pointer;
      z-index: 101;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: var(--accent-color);
    }

    .hidden {
      display: none;
    }

    .section {
      margin-bottom: 5rem;
    }

    .section-title {
      font-weight: 300;
      font-size: 1.8rem;
      margin-bottom: 2rem;
      position: relative;
      display: inline-block;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 50px;
      height: 2px;
      background: var(--gradient);
    }

    .splide {
      margin-top: 1rem;
    }

    .splide__track {
      border-radius: 12px;
      overflow: hidden;
    }

    .splide__slide {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
    }

    .splide__slide img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .splide__slide:hover img {
      transform: scale(1.05);
    }

    .splide__slide::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60%;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      z-index: 1;
    }

    .slide-title {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      z-index: 2;
      font-weight: 300;
      font-size: 0.9rem;
      max-width: 80%;
    }

    /* Mars Weather Section */
    .weather-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .weather-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .weather-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .weather-card h3 {
      font-weight: 400;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--accent-color);
    }

    .weather-value {
      font-weight: 300;
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .weather-unit {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    /* Space Facts Section */
    .facts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .fact-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .fact-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .fact-card h3 {
      font-weight: 400;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--accent-color);
    }

    .fact-card p {
      font-weight: 300;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* ISS Section */
    .iss-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .iss-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .iss-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .iss-card h3 {
      font-weight: 400;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--accent-color);
    }

    .iss-card p {
      font-weight: 300;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .map-container {
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 1.5rem;
      background: #000;
      position: relative;
    }

    #iss-map {
      width: 100%;
      height: 100%;
    }

    .map-overlay {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    /* NASA Missions Section */
    .missions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .mission-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .mission-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .mission-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient);
    }

    .mission-card h3 {
      font-weight: 400;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: var(--accent-color);
    }

    .mission-status {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 400;
      margin-bottom: 1rem;
    }

    .status-active {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .status-completed {
      background: rgba(33, 150, 243, 0.2);
      color: #2196f3;
    }

    .status-upcoming {
      background: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }

    .mission-card p {
      font-weight: 300;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .mission-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    @media (max-width: 900px) {
      .content {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1.5rem;
      }
      
      .controls-container {
        width: 100%;
        justify-content: space-between;
      }
      
      h1 {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 600px) {
      .container {
        padding: 1.5rem;
      }
      
      .splide__slide img {
        height: 150px;
      }
      
      .section-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- tsParticles background -->
  <div id="tsparticles"></div>

  <!-- Intro overlay -->
  <div class="intro-overlay" id="introOverlay">
    <div class="planet"></div>
    <div class="rocket" id="rocket">ðŸš€</div>
  </div>

  <!-- Main Container -->
  <div class="container" id="mainContainer">
    <div class="header">
      <div class="title-container">
        <img src="https://api.nasa.gov/assets/img/favicons/favicon-192.png" alt="NASA Logo" class="nasa-logo">
        <h1>Space Today</h1>
      </div>
      <div class="controls-container">
        <input type="date" id="date-picker">
        <button class="control-btn" id="randomBtn" title="Random Picture">
          <i class='bx bx-shuffle'></i>
        </button>
      </div>
    </div>
    <div class="content">
      <div class="media-container">
        <div class="loader-container" id="loader"><div class="loader"></div></div>
        <img id="apod-image" src="" alt="NASA APOD">
        <iframe id="apod-video" src="" allowfullscreen style="display: none;"></iframe>
        <div class="media-overlay">
          <button class="control-btn" id="hdBtn" title="Fullscreen">
            <i class='bx bx-fullscreen'></i>
          </button>
        </div>
      </div>
      <div class="info-container">
        <h2 id="apod-title"></h2>
        <div class="explanation-container">
          <p id="apod-explanation"></p>
          <p id="copyright"></p>
        </div>
      </div>
    </div>
    
    <!-- Recent APODs Carousel -->
    <div class="section">
      <h2 class="section-title">Recent Astronomy Pictures</h2>
      <div class="splide" id="recentApods">
        <div class="splide__track">
          <ul class="splide__list" id="recentApodsList">
            <!-- Recent APODs will be loaded here -->
          </ul>
        </div>
      </div>
    </div>

    <!-- Mars Weather Section -->
    <div class="section">
      <h2 class="section-title">Mars Weather</h2>
      <div class="weather-container" id="marsWeather">
        <!-- Mars weather data will be loaded here -->
      </div>
    </div>

    <!-- Space Facts Section -->
    <div class="section">
      <h2 class="section-title">Space Facts</h2>
      <div class="facts-grid" id="spaceFacts">
        <!-- Space facts will be loaded here -->
      </div>
    </div>

    <!-- ISS Tracker Section -->
    <div class="section">
      <h2 class="section-title">International Space Station Tracker</h2>
      <div class="iss-info">
        <div class="iss-card">
          <h3>Current Location</h3>
          <p id="iss-location">Loading...</p>
          <p id="iss-velocity">Velocity: Loading...</p>
          <p id="iss-altitude">Altitude: Loading...</p>
          <p id="iss-visibility">Visibility: Loading...</p>
        </div>
        <div class="iss-card">
          <h3>About the ISS</h3>
          <p>The International Space Station is a modular space station in low Earth orbit. It is a multinational collaborative project involving five participating space agencies.</p>
          <p>It serves as a microgravity and space environment research laboratory where scientific research is conducted in astrobiology, astronomy, meteorology, physics, and other fields.</p>
        </div>
      </div>
      <div class="map-container">
        <div id="iss-map"></div>
        <div class="map-overlay">Live ISS Position</div>
      </div>
    </div>

    <!-- NASA Missions Section -->
    <div class="section">
      <h2 class="section-title">NASA Missions</h2>
      <div class="missions-grid" id="nasaMissions">
        <!-- NASA missions will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Fullscreen Modal -->
  <div class="modal" id="modal">
    <span class="close-btn" id="closeBtn">&times;</span>
    <img class="modal-content" id="modal-image">
  </div>

  <!-- Animation Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lenis@1.0.45/dist/lenis.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Lenis smooth scroll
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smoothWheel: true
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);

      // Initialize particles
      tsParticles.load("tsparticles", {
        fpsLimit: 60,
        particles: {
          number: {
            value: 50,
            density: {
              enable: true,
              value_area: 800
            }
          },
          color: {
            value: ["#6b8afd", "#89a3ff", "#a6b9ff"]
          },
          shape: {
            type: "circle"
          },
          opacity: {
            value: 0.5,
            random: true
          },
          size: {
            value: 3,
            random: true
          },
          move: {
            enable: true,
            speed: 1,
            direction: "none",
            random: true,
            out_mode: "out",
            bounce: false
          },
          line_linked: {
            enable: true,
            distance: 150,
            color: "#6b8afd",
            opacity: 0.2,
            width: 1
          }
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: {
              enable: true,
              mode: "grab"
            },
            onclick: {
              enable: true,
              mode: "push"
            },
            resize: true
          }
        },
        retina_detect: true
      });

      // --- APOD Elements ---
      const datePicker = document.getElementById('date-picker');
      const randomBtn = document.getElementById('randomBtn');
      const loader = document.getElementById('loader');
      const errorMessageEl = document.getElementById('error-message');
      
      const imageEl = document.getElementById('apod-image');
      const videoEl = document.getElementById('apod-video');
      const titleEl = document.getElementById('apod-title');
      const explanationEl = document.getElementById('apod-explanation');
      const copyrightEl = document.getElementById('copyright');
      
      const hdBtn = document.getElementById('hdBtn');
      const modal = document.getElementById('modal');
      const modalImage = document.getElementById('modal-image');
      const closeBtn = document.getElementById('closeBtn');
      const introOverlay = document.getElementById('introOverlay');
      const mainContainer = document.getElementById('mainContainer');
      const recentApodsList = document.getElementById('recentApodsList');
      const marsWeatherEl = document.getElementById('marsWeather');
      const spaceFactsEl = document.getElementById('spaceFacts');
      const nasaMissionsEl = document.getElementById('nasaMissions');
      
      const today = new Date().toISOString().split("T")[0];
      datePicker.max = today;
      datePicker.value = today;

      // NASA API key
      const apiKey = "FycA5kfbrZx6uedypwy8HVTL3hJRbSBNJOeggVP5";

      // Initialize Splide carousel
      const splide = new Splide('#recentApods', {
        type: 'slide',
        perPage: 4,
        perMove: 1,
        gap: '1rem',
        breakpoints: {
          1200: {
            perPage: 3,
          },
          900: {
            perPage: 2,
          },
          600: {
            perPage: 1,
          },
        },
        pagination: false,
        arrows: true,
        drag: true,
      }).mount();

      // Initialize ISS Map
      let issMap, issMarker;
      function initMap() {
        issMap = L.map('iss-map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
        }).addTo(issMap);
        
        // Add ISS marker
        const issIcon = L.divIcon({
          html: '<div style="background-color: #6b8afd; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px rgba(107, 138, 253, 0.7);"></div>',
          className: 'iss-marker',
          iconSize: [16, 16],
          iconAnchor: [8, 8]
        });
        
        issMarker = L.marker([0, 0], {icon: issIcon}).addTo(issMap);
      }

      // --- Fetch APOD ---
      async function getApod(date) {
        loader.style.display = 'flex';
        imageEl.style.display = 'none';
        videoEl.style.display = 'none';

        const url = `https://api.nasa.gov/planetary/apod?api_key=${apiKey}&date=${date}`;

        try {
          const response = await fetch(url);
          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorText}`);
          }
          const data = await response.json();
          updateUI(data);
        } catch (error) {
          loader.style.display = 'none';
          errorMessageEl.textContent = "Error loading NASA data. Check console for details.";
          errorMessageEl.classList.remove('hidden');
          console.error(error.message);
        }
      }

      // --- Update UI ---
      function updateUI(data) {
        // Animate title and explanation
        gsap.fromTo(titleEl, 
          { opacity: 0, y: 20 }, 
          { opacity: 1, y: 0, duration: 0.8, ease: "power2.out" }
        );
        
        gsap.fromTo(explanationEl, 
          { opacity: 0, y: 20 }, 
          { opacity: 1, y: 0, duration: 0.8, ease: "power2.out", delay: 0.2 }
        );
        
        gsap.fromTo(copyrightEl, 
          { opacity: 0 }, 
          { opacity: 1, duration: 0.8, delay: 0.4 }
        );

        titleEl.textContent = data.title;
        explanationEl.textContent = data.explanation;
        copyrightEl.textContent = data.copyright ? `Â© ${data.copyright}` : '';

        if (data.media_type === 'image') {
          // Preload image
          const img = new Image();
          img.onload = () => {
            imageEl.src = data.url;
            imageEl.style.display = 'block';
            videoEl.style.display = 'none';
            hdBtn.style.display = 'block';
            hdBtn.onclick = () => {
              modalImage.src = data.hdurl || data.url;
              modal.style.display = 'block';
              // Animate modal image
              gsap.fromTo(modalImage, 
                { scale: 0.8, opacity: 0 }, 
                { scale: 1, opacity: 1, duration: 0.5, ease: "back.out(1.7)" }
              );
            };
            loader.style.display = 'none';
            
            // Animate image appearance
            gsap.fromTo(imageEl, 
              { scale: 0.9, opacity: 0 }, 
              { scale: 1, opacity: 1, duration: 0.8, ease: "power2.out" }
            );
          };
          img.src = data.url;
        } else if (data.media_type === 'video') {
          videoEl.src = data.url;
          videoEl.style.display = 'block';
          imageEl.style.display = 'none';
          hdBtn.style.display = 'none';
          loader.style.display = 'none';
          
          // Animate video appearance
          gsap.fromTo(videoEl, 
            { scale: 0.9, opacity: 0 }, 
            { scale: 1, opacity: 1, duration: 0.8, ease: "power2.out" }
          );
        }
      }

      // --- Fetch recent APODs for carousel ---
      async function getRecentApods() {
        const dates = [];
        const today = new Date();
        
        // Generate dates for the last 10 days
        for (let i = 0; i < 10; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() - i);
          dates.push(date.toISOString().split('T')[0]);
        }
        
        try {
          const promises = dates.map(date => 
            fetch(`https://api.nasa.gov/planetary/apod?api_key=${apiKey}&date=${date}`)
              .then(response => response.json())
          );
          
          const results = await Promise.all(promises);
          
          // Filter out videos and failed requests
          const images = results.filter(item => 
            item.media_type === 'image' && !item.error
          );
          
          // Update carousel
          recentApodsList.innerHTML = '';
          images.forEach(item => {
            const slide = document.createElement('li');
            slide.className = 'splide__slide';
            slide.innerHTML = `
              <img src="${item.url}" alt="${item.title}">
              <div class="slide-title">${item.title}</div>
            `;
            slide.addEventListener('click', () => {
              datePicker.value = item.date;
              getApod(item.date);
              // Scroll to top
              lenis.scrollTo(0, { duration: 1 });
            });
            recentApodsList.appendChild(slide);
          });
          
          // Refresh Splide
          splide.refresh();
        } catch (error) {
          console.error('Error loading recent APODs:', error);
        }
      }

      // --- Fetch Mars Weather ---
      async function getMarsWeather() {
        try {
          // Note: This is a placeholder as the Mars Weather API is no longer available
          // In a real implementation, you would use the NASA InSight API
          const weatherData = [
            { name: "Temperature", value: "-63", unit: "Â°C" },
            { name: "Pressure", value: "718", unit: "Pa" },
            { name: "Wind Speed", value: "4.3", unit: "m/s" },
            { name: "Season", value: "Winter", unit: "" }
          ];
          
          marsWeatherEl.innerHTML = '';
          weatherData.forEach(item => {
            const card = document.createElement('div');
            card.className = 'weather-card';
            card.innerHTML = `
              <h3>${item.name}</h3>
              <div class="weather-value">${item.value}<span class="weather-unit">${item.unit}</span></div>
            `;
            marsWeatherEl.appendChild(card);
          });
          
          // Animate cards
          gsap.fromTo('.weather-card', 
            { y: 30, opacity: 0 }, 
            { y: 0, opacity: 1, duration: 0.8, stagger: 0.1, ease: "power2.out" }
          );
        } catch (error) {
          console.error('Error loading Mars weather:', error);
        }
      }

      // --- Load Space Facts ---
      function loadSpaceFacts() {
        const facts = [
          {
            title: "The Moon is Drifting Away",
            content: "The Moon is moving approximately 3.8 cm away from Earth every year due to tidal interactions."
          },
          {
            title: "A Day on Venus",
            content: "Venus has the longest day of any planet in our solar system - it takes 243 Earth days to rotate once on its axis."
          },
          {
            title: "Water in Space",
            content: "There is a massive water vapor cloud in space that holds 140 trillion times the water in Earth's oceans."
          },
          {
            title: "Neutron Stars",
            content: "A neutron star is so dense that a teaspoon of its material would weigh about 10 million tons on Earth."
          }
        ];
        
        spaceFactsEl.innerHTML = '';
        facts.forEach(fact => {
          const card = document.createElement('div');
          card.className = 'fact-card';
          card.innerHTML = `
            <h3>${fact.title}</h3>
            <p>${fact.content}</p>
          `;
          spaceFactsEl.appendChild(card);
        });
        
        // Animate cards
        gsap.fromTo('.fact-card', 
          { y: 30, opacity: 0 }, 
          { y: 0, opacity: 1, duration: 0.8, stagger: 0.1, ease: "power2.out" }
        );
      }

      // --- Fetch ISS Location ---
      async function getISSLocation() {
        try {
          const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
          const data = await response.json();
          
          // Update ISS location text
          document.getElementById('iss-location').textContent = 
            `Latitude: ${data.latitude.toFixed(2)}Â°, Longitude: ${data.longitude.toFixed(2)}Â°`;
          document.getElementById('iss-velocity').textContent = 
            `Velocity: ${data.velocity.toFixed(2)} km/h`;
          document.getElementById('iss-altitude').textContent = 
            `Altitude: ${data.altitude.toFixed(2)} km`;
          document.getElementById('iss-visibility').textContent = 
            `Visibility: ${data.visibility}`;
          
          // Update map
          if (issMap && issMarker) {
            issMarker.setLatLng([data.latitude, data.longitude]);
            issMap.setView([data.latitude, data.longitude], 3);
          }
        } catch (error) {
          console.error('Error loading ISS location:', error);
        }
      }

      // --- Load NASA Missions ---
      function loadNASAMissions() {
        const missions = [
          {
            name: "Artemis Program",
            status: "upcoming",
            description: "NASA's program to return humans to the Moon and establish a sustainable presence there by the end of the decade.",
            date: "2025",
            type: "Lunar Exploration"
          },
          {
            name: "James Webb Space Telescope",
            status: "active",
            description: "The premier observatory of the next decade, serving thousands of astronomers worldwide to study the universe.",
            date: "2021",
            type: "Space Telescope"
          },
          {
            name: "Perseverance Rover",
            status: "active",
            description: "Part of NASA's Mars 2020 mission, it is searching for signs of ancient life and collecting samples for future return to Earth.",
            date: "2021",
            type: "Mars Rover"
          },
          {
            name: "DART Mission",
            status: "completed",
            description: "The Double Asteroid Redirection Test successfully demonstrated asteroid deflection technology by impacting Dimorphos.",
            date: "2022",
            type: "Planetary Defense"
          }
        ];
        
        nasaMissionsEl.innerHTML = '';
        missions.forEach(mission => {
          const card = document.createElement('div');
          card.className = 'mission-card';
          card.innerHTML = `
            <h3>${mission.name}</h3>
            <span class="mission-status status-${mission.status}">${mission.status.charAt(0).toUpperCase() + mission.status.slice(1)}</span>
            <p>${mission.description}</p>
            <div class="mission-details">
              <span>${mission.date}</span>
              <span>${mission.type}</span>
            </div>
          `;
          nasaMissionsEl.appendChild(card);
        });
        
        // Animate cards
        gsap.fromTo('.mission-card', 
          { y: 30, opacity: 0 }, 
          { y: 0, opacity: 1, duration: 0.8, stagger: 0.1, ease: "power2.out" }
        );
      }

      // --- Random Date Generator ---
      function getRandomDate() {
        const start = new Date('1995-06-16').getTime();
        const end = new Date().getTime();
        const randomTime = start + Math.random() * (end - start);
        return new Date(randomTime).toISOString().split('T')[0];
      }
      
      // --- Event Listeners ---
      datePicker.addEventListener('change', (e) => getApod(e.target.value));
      randomBtn.addEventListener('click', () => {
        const randomDate = getRandomDate();
        datePicker.value = randomDate;
        getApod(randomDate);
      });
      
      closeBtn.addEventListener('click', () => {
        gsap.to(modal, { opacity: 0, duration: 0.3, onComplete: () => {
          modal.style.display = "none";
          modal.style.opacity = 1;
        }});
      });
      
      window.addEventListener('click', (event) => {
        if (event.target == modal) {
          gsap.to(modal, { opacity: 0, duration: 0.3, onComplete: () => {
            modal.style.display = "none";
            modal.style.opacity = 1;
          }});
        }
      });

      // --- Intro Animation ---
      function playIntroAnimation() {
        const tl = gsap.timeline();
        
        // Animate planet
        tl.fromTo('.planet', 
          { scale: 0, rotation: 0 },
          { scale: 1, rotation: 360, duration: 1.5, ease: "back.out(1.7)" }
        );
        
        // Animate rocket path
        tl.fromTo('.rocket',
          { 
            x: -200, 
            y: 200,
            rotation: 45
          },
          {
            motionPath: {
              path: [
                { x: -200, y: 200 },
                { x: 0, y: 0 },
                { x: 200, y: -200 }
              ],
              curviness: 1.5
            },
            rotation: 0,
            duration: 2,
            ease: "power2.inOut"
          },
          "-=1" // Overlap with previous animation
        );
        
        // Fade out intro and reveal main content
        tl.to(introOverlay, {
          opacity: 0,
          duration: 0.8,
          ease: "power2.inOut",
          onComplete: () => {
            introOverlay.style.display = 'none';
            
            // Animate main container
            gsap.to(mainContainer, {
              opacity: 1,
              y: 0,
              duration: 1,
              ease: "power2.out"
            });
          }
        });
      }

      // --- Initialize App ---
      function initApp() {
        // Play intro animation
        playIntroAnimation();
        
        // Initialize map
        initMap();
        
        // Load today's APOD
        getApod(today);
        
        // Load recent APODs for carousel
        getRecentApods();
        
        // Load additional sections
        getMarsWeather();
        loadSpaceFacts();
        loadNASAMissions();
        
        // Start ISS tracking
        getISSLocation();
        setInterval(getISSLocation, 5000); // Update every 5 seconds
        
        // Set up GSAP ScrollTrigger
        gsap.registerPlugin(ScrollTrigger);
        
        // Animate elements on scroll
        gsap.utils.toArray('.section').forEach(section => {
          gsap.fromTo(section, 
            { y: 50, opacity: 0 },
            {
              y: 0,
              opacity: 1,
              duration: 1,
              ease: "power2.out",
              scrollTrigger: {
                trigger: section,
                start: "top 80%",
                end: "bottom 20%",
                toggleActions: "play none none reverse"
              }
            }
          );
        });
      }

      // Start the app
      initApp();
    });
  </script>
</body>
</html>
